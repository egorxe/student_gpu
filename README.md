# Student GPU

## Инструкции

### Запуск эмулятора конвейера GPU

Эмулятор запускается из папки src/emu командой:
```
./gpu_emu.py config.json
```
, где config.json - имя конфигурационного файла эмулятора, если его не указывать, то будет использован конфиг-файл gpu_config.json. 

Для перекомпиляции кода C++ стадий эмулятора после их изменения необходимо либо выполнить команду make в папке изменённой стадии, либо для проверки всех стадий и пересборки изменившихся выполнить make в папке src/emu. Можно запускать make перед каждым стартом эмулятора, например так:
```
make && ./gpu_emu.py gpu_config.json
```


### Добавление RTL реализации стадии конвейера GPU

Для добавления своей VHDL реализации стадии конвейера необходимо создать для неё подпапку в src/rtl, после чего добавить скрипт для запуска симулятора. В качестве скрипта запуска рекомендуется использовать скрипт ghdl_sim/stage_sim.sh из папки примера src/rtl/test_vertices. Для его использования необходимо по аналогии создать в папке своей стадии подпапку ghdl_sim и скопировать в неё скрипт stage_sim.sh. В скрипте необходимо откорректировать значения переменных:
- *TOP* - имя entity верхнего уровня;
- *SOURCES_BASEPATH* - базовый путь до исходников относительно расположения скрипта, если все файлы лежат в папке стадии, то можно просто оставить "..";
- *SOURCES* - список исходников (с путями относительно базового), если нужно компилировать все vhd-файлы в базовой папке, то можно оставить "*.vhd";
- *PACKAGES* - файлы пакетов из папки src/rtl/pkg, обычно менять не требуется.

Теперь для использования RTL-стадии в конвейере эмулятора необходимо создать JSON-конфиг. Базовый конфиг использующий на всех стадиях референсные C++ реализации находится в gpu_config.json. В качестве примера с RTL-стадией можно использовать rtltestvertices.json, где первая стадия генерирующая тестовые вершины заменена на src/rtl/test_vertices (см. значение "binary"). Для оптимальной производительности и во избежании наложения ошибок в каждом отдельном конфиге рекомендуется заменять на RTL только одну стадию. 
